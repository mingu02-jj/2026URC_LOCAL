<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="urc_rover">

  <xacro:arg name="camera_name" default="zed"/>
  <xacro:arg name="camera_model" default="zed2"/>
  
  <material name="white">
    <color rgba="1 1 1 1"/>
  </material>
  <material name="gray">
    <color rgba="0.5 0.5 0.5 1"/>
  </material>
  
  
  <!-- ============================= -->
  <!-- BASE LINK / FOOTPRINT -->
  <!-- ============================= -->
  <link name="base_link"/>
  <link name="base_footprint"/>

  <joint name="base_footprint_joint" type="fixed">
    <parent link="base_link"/>
    <child link="base_footprint"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

  <!-- ============================= -->
  <!-- CHASSIS -->
  <!-- ============================= -->
  <link name="chassis_link">
    <visual>
      <origin xyz="0.242 0 0.0815"/>
      <geometry><box size="0.484 0.406 0.163"/></geometry>
      <material name="white"/>
    </visual>
    <collision>
      <origin xyz="0.242 0 0.0815"/>
      <geometry><box size="0.484 0.406 0.163"/></geometry>
    </collision>
  </link>

  <joint name="chassis_joint" type="fixed">
    <parent link="base_link"/>
    <child link="chassis_link"/>
    <origin xyz="-0.242 0 0" rpy="0 0 0"/>
  </joint>

  <!-- ============================= -->
  <!-- WHEELS (Front/Rear × Left/Right) -->
  <!-- ============================= -->
  <link name="front_left_wheel_link">
    <visual><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry><material name="gray"/></visual>
    <collision><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry></collision>
  </link>

  <joint name="front_left_wheel_joint" type="continuous">
    <parent link="front_left_steer_link"/>
    <child link="front_left_wheel_link"/>
    <origin xyz="0 0 -0.134775" rpy="-${pi/2} 0 0"/>
    <axis xyz="0 0 1"/>
  </joint>

  <link name="front_right_wheel_link">
    <visual><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry><material name="gray"/></visual>
    <collision><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry></collision>
  </link>

  <joint name="front_right_wheel_joint" type="continuous">
    <parent link="front_right_steer_link"/>
    <child link="front_right_wheel_link"/>
    <origin xyz="0 0 -0.134775" rpy="${pi/2} 0 0"/>
    <axis xyz="0 0 -1"/>
  </joint>

  <link name="rear_left_wheel_link">
    <visual><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry><material name="gray"/></visual>
    <collision><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry></collision>
  </link>

  <joint name="rear_left_wheel_joint" type="continuous">
    <parent link="rear_left_steer_link"/>
    <child link="rear_left_wheel_link"/>
    <origin xyz="0 0 -0.134775" rpy="-${pi/2} 0 0"/>
    <axis xyz="0 0 1"/>
  </joint>

  <link name="rear_right_wheel_link">
    <visual><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry><material name="gray"/></visual>
    <collision><geometry><cylinder radius="0.0939445" length="0.0628"/></geometry></collision>
  </link>

  <joint name="rear_right_wheel_joint" type="continuous">
    <parent link="rear_right_steer_link"/>
    <child link="rear_right_wheel_link"/>
    <origin xyz="0 0 -0.134775" rpy="${pi/2} 0 0"/>
    <axis xyz="0 0 -1"/>
  </joint>

  <!-- ============================= -->
  <!-- STEER LINKS -->
  <!-- ============================= -->
  <xacro:macro name="steer_link_macro" params="name parent x y z">
    <link name="${name}_steer_link">
      <visual><geometry><cylinder radius="0.02" length="0.027111"/></geometry></visual>
      <collision><geometry><cylinder radius="0.02" length="0.027111"/></geometry></collision>
    </link>
    <joint name="${name}_steer_joint" type="continuous">
      <parent link="${parent}"/>
      <child link="${name}_steer_link"/>
      <origin xyz="${x} ${y} ${z}" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
    </joint>
  </xacro:macro>

  <xacro:steer_link_macro name="front_left"  parent="base_link" x="0.3318875"  y="0.2585"  z="-0.013555"/>
  <xacro:steer_link_macro name="front_right" parent="base_link" x="0.3318875"  y="-0.2585" z="-0.013555"/>
  <xacro:steer_link_macro name="rear_left"   parent="base_link" x="-0.3318875" y="0.2585"  z="-0.013555"/>
  <xacro:steer_link_macro name="rear_right"  parent="base_link" x="-0.3318875" y="-0.2585" z="-0.013555"/>

  <!-- ============================= -->
  <!-- ZED CAMERA -->
  <!-- ============================= -->

  <!-- ROS2 xacro에서는 find-pkg-share 대신 find -->
  <xacro:include filename="$(find zed_wrapper)/urdf/zed_macro.urdf.xacro"/>

  
  <xacro:zed_camera name="$(arg camera_name)" model="$(arg camera_model)">
   <gnss_origin/>
  </xacro:zed_camera>

  <joint name="zed_joint" type="fixed">
    <parent link="base_link"/>
    <child link="$(arg camera_name)_camera_link"/>
    <origin xyz="0.226 0.0 0.0955" rpy="0 0 0"/>
  </joint>
  
  

  <!-- ============================= -->
  <!-- GNSS LINK -->
  <!-- ============================= -->
  <link name="gps_link"/>
  <joint name="gps_joint" type="fixed">
    <parent link="base_link"/>
    <child link="gps_link"/>
    <origin xyz="-0.2425 -0.2035 0.2485" rpy="0 0 0"/>
  </joint>

</robot>

